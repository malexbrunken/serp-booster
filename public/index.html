<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SERP Booster Dashboard</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: #f5f7fa;
      color: #333;
      min-height: 100vh;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .header h1 {
      font-size: 24px;
      font-weight: 600;
    }
    
    .header p {
      opacity: 0.9;
      margin-top: 5px;
      font-size: 14px;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .tab {
      padding: 12px 24px;
      background: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .tab:hover {
      background: #f0f0f0;
    }
    
    .tab.active {
      background: #667eea;
      color: white;
    }
    
    .panel {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      display: none;
    }
    
    .panel.active {
      display: block;
    }
    
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .panel-title {
      font-size: 18px;
      font-weight: 600;
    }
    
    .list-section {
      margin-bottom: 30px;
    }
    
    .list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .list-name {
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .badge-whitelist { background: #d4edda; color: #155724; }
    .badge-greylist { background: #fff3cd; color: #856404; }
    .badge-blacklist { background: #f8d7da; color: #721c24; }
    
    .add-form {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .add-form input {
      flex: 1;
      padding: 10px 14px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .add-form button {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
    }
    
    .add-form button:hover {
      background: #5a6fd6;
    }
    
    .item-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      background: #f9f9f9;
      border-radius: 6px;
      gap: 15px;
    }
    
    .item-keyword {
      flex: 1;
      font-weight: 500;
    }
    
    .item-url {
      flex: 2;
      color: #666;
      font-size: 13px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .item-delete {
      background: none;
      border: none;
      color: #999;
      cursor: pointer;
      font-size: 18px;
      padding: 5px;
    }
    
    .item-delete:hover {
      color: #dc3545;
    }
    
    .empty-state {
      text-align: center;
      padding: 30px;
      color: #999;
    }
    
    /* Run Panel */
    .run-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .control-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      font-size: 14px;
    }
    
    .control-group select,
    .control-group input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
    }
    
    .run-button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }
    
    .run-button:hover:not(:disabled) {
      transform: translateY(-2px);
    }
    
    .run-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .progress-section {
      margin-top: 20px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 8px;
      display: none;
    }
    
    .progress-section.active {
      display: block;
    }
    
    .progress-bar {
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      width: 0%;
      transition: width 0.3s;
    }
    
    .progress-text {
      font-size: 14px;
      color: #666;
    }
    
    .results-section {
      margin-top: 20px;
      padding: 20px;
      background: #f0f7ff;
      border-radius: 8px;
      display: none;
    }
    
    .results-section.active {
      display: block;
    }
    
    .result-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .stat {
      text-align: center;
      padding: 15px;
      background: white;
      border-radius: 8px;
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: 700;
      color: #667eea;
    }
    
    .stat-label {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
    
    /* History Panel */
    .chart-container {
      height: 300px;
      margin-bottom: 30px;
    }
    
    .history-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .history-table th,
    .history-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    
    .history-table th {
      font-weight: 600;
      background: #f9f9f9;
    }
    
    .positive { color: #28a745; }
    .negative { color: #dc3545; }
    
    /* Autocomplete Panel */
    .autocomplete-help {
      background: #fff3cd;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      font-size: 14px;
    }
    
    .autocomplete-help strong {
      color: #856404;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ðŸš€ SERP Booster Dashboard</h1>
    <p>Strategic search ranking booster with whitelist/greylist/blacklist strategy</p>
  </div>
  
  <div class="container">
    <div class="tabs">
      <button class="tab active" data-panel="lists">Lists</button>
      <button class="tab" data-panel="autocomplete">Autocomplete Terms</button>
      <button class="tab" data-panel="run">Run Booster</button>
      <button class="tab" data-panel="history">Results History</button>
    </div>
    
    <!-- Lists Panel -->
    <div class="panel active" id="lists-panel">
      <div class="panel-header">
        <div class="panel-title">Target Lists</div>
        <button class="button" onclick="saveLists()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer;">Save All</button>
      </div>
      
      <div class="list-section">
        <div class="list-header">
          <div class="list-name">
            <span class="badge badge-whitelist">WHITELIST</span>
            Websites we control and want to promote
          </div>
        </div>
        <div class="add-form">
          <input type="text" id="whitelist-keyword" placeholder="Search term (e.g., 'reputation management')">
          <input type="text" id="whitelist-url" placeholder="Target URL (e.g., https://mysite.com)">
          <button onclick="addItem('whitelist')">Add</button>
        </div>
        <div class="item-list" id="whitelist-items"></div>
      </div>
      
      <div class="list-section">
        <div class="list-header">
          <div class="list-name">
            <span class="badge badge-greylist">GREYLIST</span>
            Neutral/benign sites (for natural appearance)
          </div>
        </div>
        <div class="add-form">
          <input type="text" id="greylist-keyword" placeholder="Search term">
          <input type="text" id="greylist-url" placeholder="Target URL">
          <button onclick="addItem('greylist')">Add</button>
        </div>
        <div class="item-list" id="greylist-items"></div>
      </div>
      
      <div class="list-section">
        <div class="list-header">
          <div class="list-name">
            <span class="badge badge-blacklist">BLACKLIST</span>
            Problematic sites we want to outrank (never clicked)
          </div>
        </div>
        <div class="add-form">
          <input type="text" id="blacklist-keyword" placeholder="Search term (e.g., 'John Doe scam')">
          <input type="text" id="blacklist-url" placeholder="Problem URL to outrank">
          <button onclick="addItem('blacklist')">Add</button>
        </div>
        <div class="item-list" id="blacklist-items"></div>
      </div>
    </div>
    
    <!-- Autocomplete Panel -->
    <div class="panel" id="autocomplete-panel">
      <div class="panel-header">
        <div class="panel-title">Autocomplete Terms</div>
        <button class="button" onclick="saveAutocomplete()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer;">Save</button>
      </div>
      
      <div class="autocomplete-help">
        <strong>What is this?</strong> These terms control what Google suggests when users type. 
        For example, if you add "johndoe | john doe official", when someone types "johndoe" in Google, 
        "john doe official" will appear as a suggestion. This builds positive autocomplete presence.
      </div>
      
      <div class="add-form">
        <input type="text" id="autocomplete-prefix" placeholder="Prefix (e.g., 'johndoe')">
        <input type="text" id="autocomplete-term" placeholder="Full term (e.g., 'john doe verified')">
        <button onclick="addAutocomplete()">Add</button>
      </div>
      <div class="item-list" id="autocomplete-items"></div>
    </div>
    
    <!-- Run Panel -->
    <div class="panel" id="run-panel">
      <div class="panel-header">
        <div class="panel-title">Run SERP Booster</div>
      </div>
      
      <div class="run-controls">
        <div class="control-group">
          <label>Strategy Mode</label>
          <select id="run-mode">
            <option value="natural">Natural (balanced)</option>
            <option value="stealth">Stealth (sneaky)</option>
            <option value="aggressive">Aggressive (fast)</option>
          </select>
        </div>
        <div class="control-group">
          <label>Dwell Time (seconds)</label>
          <input type="number" id="run-dwell" value="30" min="10" max="120">
        </div>
        <div class="control-group">
          <label>Summary</label>
          <div style="padding: 10px; background: #f9f9f9; border-radius: 6px; font-size: 13px;">
            <div id="run-summary">0 whitelist | 0 greylist | 0 blacklist items</div>
          </div>
        </div>
      </div>
      
      <button class="run-button" id="run-button" onclick="runBooster()">
        ðŸš€ Start SERP Booster
      </button>
      
      <div class="progress-section" id="progress-section">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-text" id="progress-text">Starting...</div>
      </div>
      
      <div class="results-section" id="results-section">
        <h3 style="margin-bottom: 15px;">Results</h3>
        <div class="result-stats">
          <div class="stat">
            <div class="stat-value" id="result-clicks">0</div>
            <div class="stat-label">Total Clicks</div>
          </div>
          <div class="stat">
            <div class="stat-value positive" id="result-whitelist">+0</div>
            <div class="stat-label">Whitelist Improved</div>
          </div>
          <div class="stat">
            <div class="stat-value" id="result-blacklist">+0</div>
            <div class="stat-label">Blacklist Demoted</div>
          </div>
        </div>
        <pre id="result-output" style="background: white; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 12px; max-height: 200px;"></pre>
      </div>
    </div>
    
    <!-- History Panel -->
    <div class="panel" id="history-panel">
      <div class="panel-header">
        <div class="panel-title">Results History</div>
      </div>
      
      <div class="chart-container">
        <canvas id="position-chart"></canvas>
      </div>
      
      <table class="history-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Clicks</th>
            <th>Whitelist Î”</th>
            <th>Blacklist Î”</th>
          </tr>
        </thead>
        <tbody id="history-body"></tbody>
      </table>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let lists = { whitelist: [], greylist: [], blacklist: [] };
    let autocomplete = { terms: [] };
    let history = [];
    let chart = null;
    
    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(tab.dataset.panel + '-panel').classList.add('active');
        
        if (tab.dataset.panel === 'history') loadHistory();
      });
    });
    
    // Load data on startup
    loadLists();
    loadAutocomplete();
    
    // Lists functions
    async function loadLists() {
      const res = await fetch('/api/lists');
      lists = await res.json();
      renderLists();
      updateRunSummary();
    }
    
    async function saveLists() {
      await fetch('/api/lists', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(lists)
      });
      alert('Lists saved!');
    }
    
    function renderLists() {
      ['whitelist', 'greylist', 'blacklist'].forEach(list => {
        const container = document.getElementById(list + '-items');
        if (lists[list].length === 0) {
          container.innerHTML = '<div class="empty-state">No items yet. Add some above.</div>';
        } else {
          container.innerHTML = lists[list].map((item, i) => `
            <div class="item">
              <span class="item-keyword">${item.keyword}</span>
              <span class="item-url">${item.url}</span>
              <button class="item-delete" onclick="removeItem('${list}', ${i})">Ã—</button>
            </div>
          `).join('');
        }
      });
    }
    
    function addItem(list) {
      const keyword = document.getElementById(list + '-keyword').value.trim();
      const url = document.getElementById(list + '-url').value.trim();
      if (!keyword || !url) return;
      
      lists[list].push({ keyword, url });
      document.getElementById(list + '-keyword').value = '';
      document.getElementById(list + '-url').value = '';
      renderLists();
      updateRunSummary();
    }
    
    function removeItem(list, index) {
      lists[list].splice(index, 1);
      renderLists();
      updateRunSummary();
    }
    
    function updateRunSummary() {
      const total = lists.whitelist.length + lists.greylist.length + lists.blacklist.length;
      document.getElementById('run-summary').textContent = 
        `${lists.whitelist.length} whitelist | ${lists.greylist.length} greylist | ${lists.blacklist.length} blacklist items`;
    }
    
    // Autocomplete functions
    async function loadAutocomplete() {
      const res = await fetch('/api/autocomplete');
      autocomplete = await res.json();
      renderAutocomplete();
    }
    
    async function saveAutocomplete() {
      await fetch('/api/autocomplete', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(autocomplete)
      });
      alert('Autocomplete terms saved!');
    }
    
    function renderAutocomplete() {
      const container = document.getElementById('autocomplete-items');
      if (autocomplete.terms.length === 0) {
        container.innerHTML = '<div class="empty-state">No autocomplete terms yet.</div>';
      } else {
        container.innerHTML = autocomplete.terms.map((t, i) => `
          <div class="item">
            <span class="item-keyword">"${t.prefix}"</span>
            <span class="item-url">â†’ "${t.term}"</span>
            <button class="item-delete" onclick="removeAutocomplete(${i})">Ã—</button>
          </div>
        `).join('');
      }
    }
    
    function addAutocomplete() {
      const prefix = document.getElementById('autocomplete-prefix').value.trim();
      const term = document.getElementById('autocomplete-term').value.trim();
      if (!prefix || !term) return;
      
      autocomplete.terms.push({ prefix, term });
      document.getElementById('autocomplete-prefix').value = '';
      document.getElementById('autocomplete-term').value = '';
      renderAutocomplete();
    }
    
    function removeAutocomplete(index) {
      autocomplete.terms.splice(index, 1);
      renderAutocomplete();
    }
    
    // Run functions
    async function runBooster() {
      const button = document.getElementById('run-button');
      const progress = document.getElementById('progress-section');
      const results = document.getElementById('results-section');
      
      button.disabled = true;
      button.textContent = 'Running...';
      progress.classList.add('active');
      results.classList.remove('active');
      
      document.getElementById('progress-fill').style.width = '30%';
      document.getElementById('progress-text').textContent = 'Building keyword lists...';
      
      try {
        const res = await fetch('/api/run', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            mode: document.getElementById('run-mode').value,
            dwell: document.getElementById('run-dwell').value
          })
        });
        
        const data = await res.json();
        
        document.getElementById('progress-fill').style.width = '100%';
        document.getElementById('progress-text').textContent = 'Complete!';
        
        if (data.results) {
          document.getElementById('result-clicks').textContent = data.results.clicks || 0;
          document.getElementById('result-whitelist').textContent = '+' + (data.results.whitelistImprovement || 0);
          document.getElementById('result-blacklist').textContent = '+' + (data.results.blacklistDemotion || 0);
          document.getElementById('result-output').textContent = data.results.output || '';
          results.classList.add('active');
        }
      } catch (err) {
        document.getElementById('progress-text').textContent = 'Error: ' + err.message;
      }
      
      button.disabled = false;
      button.textContent = 'ðŸš€ Start SERP Booster';
    }
    
    // History functions
    async function loadHistory() {
      const res = await fetch('/api/history');
      history = await res.json();
      renderHistory();
      renderChart();
    }
    
    function renderHistory() {
      const tbody = document.getElementById('history-body');
      if (history.length === 0) {
        tbody.innerHTML = '<tr><td colspan="4" class="empty-state">No runs yet. Run the booster to see results.</td></tr>';
        return;
      }
      
      tbody.innerHTML = history.slice().reverse().map(h => `
        <tr>
          <td>${new Date(h.date).toLocaleString()}</td>
          <td>${h.clicks || 0}</td>
          <td class="positive">+${h.whitelistImprovement || 0}</td>
          <td>+${h.blacklistDemotion || 0}</td>
        </tr>
      `).join('');
    }
    
    function renderChart() {
      const ctx = document.getElementById('position-chart').getContext('2d');
      
      const labels = history.map(h => new Date(h.date).toLocaleDateString());
      const whitelistData = history.map(h => h.whitelistImprovement || 0);
      const blacklistData = history.map(h => h.blacklistDemotion || 0);
      
      if (chart) chart.destroy();
      
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels,
          datasets: [
            {
              label: 'Whitelist Improvement',
              data: whitelistData,
              borderColor: '#28a745',
              backgroundColor: 'rgba(40, 167, 69, 0.1)',
              tension: 0.3
            },
            {
              label: 'Blacklist Demotion',
              data: blacklistData,
              borderColor: '#dc3545',
              backgroundColor: 'rgba(220, 53, 69, 0.1)',
              tension: 0.3
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            title: {
              display: true,
              text: 'Average Position Changes Over Time'
            }
          },
          scales: {
            y: {
              title: {
                display: true,
                text: 'Position Change (higher = better)'
              }
            }
          }
        }
      });
    }
  </script>
</body>
</html>
